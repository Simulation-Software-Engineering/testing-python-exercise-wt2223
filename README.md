# Python code to solve the diffusion equation in 2D

Please follow the instructions in [python_testing_exercise.md](https://github.com/Simulation-Software-Engineering/Lecture-Material/blob/main/05_testing_and_ci/python_testing_exercise.md).

## Test logs (for submission)

### pytest log

```
till@till-VirtualBox:~/Projects/testing-python-exercise-wt2223$ python3 -m pytest tests/
================================================== test session starts ==================================================
platform linux -- Python 3.10.6, pytest-7.2.1, pluggy-1.0.0
rootdir: /home/till/Projects/testing-python-exercise-wt2223
collected 5 items                                                                                                       

tests/integration/test_diffusion2d.py ..                                                                          [ 40%]
tests/unit/test_diffusion2d_functions.py FFF                                                                      [100%]

======================================================= FAILURES ========================================================
________________________________________________ test_initialize_domain _________________________________________________

    def test_initialize_domain():
        """
        Check function SolveDiffusion2D.initialize_domain
        """
        w = 5.
        h = 5.
        dx = 0.2
        dy = 0.2
        nx = 25
        ny = 25
    
        solver = SolveDiffusion2D()
        solver.initialize_domain(w, h, dx, dy)
    
>       assert nx == solver.nx
E       assert 25 == 1
E        +  where 1 = <diffusion2d.SolveDiffusion2D object at 0x7fa19e39e020>.nx

tests/unit/test_diffusion2d_functions.py:23: AssertionError
__________________________________________ test_initialize_physical_parameters __________________________________________

    def test_initialize_physical_parameters():
        """
        Checks function SolveDiffusion2D.initialize_domain
        """
        d = 2.
        T_cold = 200.
        T_hot = 600.
        dt = 0.005000000000000001
    
        solver = SolveDiffusion2D()
        solver.dx = 0.2
        solver.dy = 0.2
        solver.initialize_physical_parameters(d, T_cold, T_hot)
    
>       assert dt == solver.dt
E       assert 0.005000000000000001 == 0.009615384615384618
E        +  where 0.009615384615384618 = <diffusion2d.SolveDiffusion2D object at 0x7fa19e3e3c10>.dt

tests/unit/test_diffusion2d_functions.py:41: AssertionError
------------------------------------------------- Captured stdout call --------------------------------------------------
dt = 0.009615384615384618
______________________________________________ test_set_initial_condition _______________________________________________

    def test_set_initial_condition():
        """
        Checks function SolveDiffusion2D.get_initial_function
        """
        expectedArray = [[200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 600.,
            600., 600., 600.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 200., 600., 600., 600.,
            600., 600., 600.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 200., 600., 600., 600., 600.,
            600., 600., 600.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 600., 600., 600., 600., 600.,
            600., 600., 600.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 200., 600., 600., 600., 600., 600.,
            600., 600., 600.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 600., 600., 600., 600., 600., 600.,
            600., 600., 600.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 600., 600., 600., 600., 600., 600.,
            600., 600., 600.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 600., 600., 600., 600., 600., 600.,
            600., 600., 600.],
           [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
            200., 200., 200., 200., 200., 600., 600., 600., 600., 600., 600.,
            600., 600., 600.]]
    
        solver = SolveDiffusion2D()
        solver.nx = 25
        solver.ny = 25
        solver.dx = 0.2
        solver.dy = 0.2
        solver.T_cold = 200.
        solver.T_hot = 600.
        result = solver.set_initial_condition()
    
>       np.testing.assert_array_equal(result, expectedArray)
E       AssertionError: 
E       Arrays are not equal
E       
E       Mismatched elements: 625 / 625 (100%)
E       Max absolute difference: 400.
E       Max relative difference: 2.
E        x: array([[600., 600., 600., 600., 600., 600., 600., 600., 600., 600., 600.,
E               600., 600., 600., 600., 600., 600., 600., 600., 600., 600., 600.,
E               600., 600., 600.],...
E        y: array([[200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
E               200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
E               200., 200., 200.],...

tests/unit/test_diffusion2d_functions.py:133: AssertionError
================================================ short test summary info ================================================
FAILED tests/unit/test_diffusion2d_functions.py::test_initialize_domain - assert 25 == 1
FAILED tests/unit/test_diffusion2d_functions.py::test_initialize_physical_parameters - assert 0.005000000000000001 == 0.009615384615384618
FAILED tests/unit/test_diffusion2d_functions.py::test_set_initial_condition - AssertionError: 
============================================== 3 failed, 2 passed in 0.66s ==============================================
```

### unittest log

```
till@till-VirtualBox:~/Projects/testing-python-exercise-wt2223$ python3 -m unittest tests/unit/test_operations_unittests.py
Fdt = 0.009615384615384618
FF
======================================================================
FAIL: test_initialize_domain (tests.unit.test_operations_unittests.TestDiffusion2D)
Check function SolveDiffusion2D.initialize_domain
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/till/Projects/testing-python-exercise-wt2223/tests/unit/test_operations_unittests.py", line 34, in test_initialize_domain
    self.assertEqual(nx, self.solver.nx)
AssertionError: 25 != 1

======================================================================
FAIL: test_initialize_physical_parameters (tests.unit.test_operations_unittests.TestDiffusion2D)
Checks function SolveDiffusion2D.initialize_domain
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/till/Projects/testing-python-exercise-wt2223/tests/unit/test_operations_unittests.py", line 49, in test_initialize_physical_parameters
    self.assertEqual(dt,self.solver.dt)
AssertionError: 0.005000000000000001 != 0.009615384615384618

======================================================================
FAIL: test_set_initial_condition (tests.unit.test_operations_unittests.TestDiffusion2D)
Checks function SolveDiffusion2D.get_initial_function
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/till/Projects/testing-python-exercise-wt2223/tests/unit/test_operations_unittests.py", line 134, in test_set_initial_condition
    np.testing.assert_array_equal(result, expectedArray)
  File "/usr/lib/python3/dist-packages/numpy/testing/_private/utils.py", line 934, in assert_array_equal
    assert_array_compare(operator.__eq__, x, y, err_msg=err_msg,
  File "/usr/lib/python3/dist-packages/numpy/testing/_private/utils.py", line 844, in assert_array_compare
    raise AssertionError(msg)
AssertionError: 
Arrays are not equal

Mismatched elements: 625 / 625 (100%)
Max absolute difference: 400.
Max relative difference: 2.
 x: array([[600., 600., 600., 600., 600., 600., 600., 600., 600., 600., 600.,
        600., 600., 600., 600., 600., 600., 600., 600., 600., 600., 600.,
        600., 600., 600.],...
 y: array([[200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
        200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
        200., 200., 200.],...

----------------------------------------------------------------------
Ran 3 tests in 0.010s

FAILED (failures=3)
```

### Integration test log

```
till@till-VirtualBox:~/Projects/testing-python-exercise-wt2223$ python3 -m pytest tests/integration/
=========================================== test session starts ===========================================
platform linux -- Python 3.10.6, pytest-7.2.1, pluggy-1.0.0
rootdir: /home/till/Projects/testing-python-exercise-wt2223
collected 2 items                                                                                         

tests/integration/test_diffusion2d.py FF                                                            [100%]

================================================ FAILURES =================================================
___________________________________ test_initialize_physical_parameters ___________________________________

    def test_initialize_physical_parameters():
        """
        Checks function SolveDiffusion2D.initialize_domain
        """
        w = 5.
        h = 5.
        dx = 0.2
        dy = 0.2
        d = 2.
        T_cold = 200.
        T_hot = 600.
        dt = 0.005000000000000001
    
        solver = SolveDiffusion2D()
        solver.initialize_domain(w, h, dx, dy)
        solver.initialize_physical_parameters(d, T_cold, T_hot)
    
>       assert dt == solver.dt
E       assert 0.005000000000000001 == 0.009615384615384618
E        +  where 0.009615384615384618 = <diffusion2d.SolveDiffusion2D object at 0x7f0415d699c0>.dt

tests/integration/test_diffusion2d.py:26: AssertionError
------------------------------------------ Captured stdout call -------------------------------------------
dt = 0.009615384615384618
_______________________________________ test_set_initial_condition ________________________________________

    def test_set_initial_condition():
        """
        Checks function SolveDiffusion2D.get_initial_function
        """
    
        expectedArray = [[200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 600.,
                600., 600., 600.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 200., 600., 600., 600.,
                600., 600., 600.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 200., 600., 600., 600., 600.,
                600., 600., 600.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 600., 600., 600., 600., 600.,
                600., 600., 600.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 200., 600., 600., 600., 600., 600.,
                600., 600., 600.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 600., 600., 600., 600., 600., 600.,
                600., 600., 600.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 600., 600., 600., 600., 600., 600.,
                600., 600., 600.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 600., 600., 600., 600., 600., 600.,
                600., 600., 600.],
            [200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
                200., 200., 200., 200., 200., 600., 600., 600., 600., 600., 600.,
                600., 600., 600.]]
    
        w = 5.
        h = 5.
        dx = 0.2
        dy = 0.2
        d = 2.
        T_cold = 200.
        T_hot = 600.
        dt = 0.005000000000000001
    
        solver = SolveDiffusion2D()
        solver.initialize_domain(w, h, dx, dy)
        solver.initialize_physical_parameters(d, T_cold, T_hot)
        result = solver.set_initial_condition()
    
>       np.testing.assert_array_equal(result, expectedArray)
E       AssertionError: 
E       Arrays are not equal
E       
E       (shapes (1, 25), (25, 25) mismatch)
E        x: array([[600., 600., 600., 600., 600., 600., 600., 600., 600., 600., 600.,
E               600., 600., 600., 600., 600., 600., 600., 600., 600., 600., 600.,
E               600., 600., 600.]])
E        y: array([[200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
E               200., 200., 200., 200., 200., 200., 200., 200., 200., 200., 200.,
E               200., 200., 200.],...

tests/integration/test_diffusion2d.py:123: AssertionError
------------------------------------------ Captured stdout call -------------------------------------------
dt = 0.009615384615384618
========================================= short test summary info =========================================
FAILED tests/integration/test_diffusion2d.py::test_initialize_physical_parameters - assert 0.005000000000000001 == 0.009615384615384618
FAILED tests/integration/test_diffusion2d.py::test_set_initial_condition - AssertionError: 
============================================ 2 failed in 0.73s ============================================
```

## Citing

The code used in this exercise is based on [Chapter 7 of the book "Learning Scientific Programming with Python"](https://scipython.com/book/chapter-7-matplotlib/examples/the-two-dimensional-diffusion-equation/).
